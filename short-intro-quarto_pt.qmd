---
title: "Uma introdu√ß√£o ao Quarto"
date: 2024-08-28
license: CC BY-NC-SA
author:
  - name: Jesus M. Castagnetto, Ph.D.
    orcid: 0000-0002-7188-1605
    email: jesus@upch.pe
    affiliation: INSIGHT Project - Universidad Peruana Cayetano Heredia (UPCH)
format: 
  revealjs: 
    theme: [default, style.scss]
    transition: slide
    fontcolor: "#262d36"
    chalkboard: true
    highlight-style: a11y
    code-line-numbers: false
    self-contained-math: true
    code-annotations: hover
    preview-links: true
    slide-number: true
    show-slide-number: all
    logo: images/quarto.png
    footer: Uma introdu√ß√£o ao Quarto // Jesus M. Castagnetto // INSIGHT - UPCH, 2024
    pointer:
      pointersize: 18
    mermaid-format: png
    fig-width: 12
  #pptx: default

lang: pt

revealjs-plugins:
  - pointer
  - attribution

---

## Agenda

- O que √© Quarto e para que serve?
- Conceitos b√°sicos de programa√ß√£o literal
- O que podemos criar com Quarto (Exemplos)
- Estrutura de um documento em Quarto
- Pr√≥ximos passos

::: notes
**Dizer**:

Voc√™ provavelmente n√£o conhece muito sobre o Quarto e a tecnologia que ele representa. Esta apresenta√ß√£o tem como objetivo lhe dar uma introdu√ß√£o ao Quarto, como ele pode ser usado com R para criar relat√≥rios, sites, apresenta√ß√µes como esta, dashboards, etc.
:::

## O que √© quarto? {.title-top-azure background-image="images/horst-quarto-meteor-transparent.png" aria-label="Um meteoro cuja cabe√ßa √© o logotipo do Quarto"}

::: attribution
Arte de [Allison Horst](https://allisonhorst.com/)
:::

## Quarto^¬Æ^ (1)

- √â um novo^[Quarto foi anunciado em 2022] sistema de c√≥digo aberto, para produ√ß√£o de publica√ß√µes cient√≠ficas e t√©cnicas, que reutiliza ferramentas abertas existentes
- Baseado na combina√ß√£o de descri√ß√£o (texto) e c√≥digo (**R**, Python, etc.) para gerar relat√≥rios, livros, sites, dashboards, apresenta√ß√µes (como esta üòÑ), etc.

## Quarto^¬Æ^ (2)

- Aprenda com quase uma d√©cada de uso do RMarkdown^[A primeira vers√£o do RMarkdown √© de 2014] pela comunidade global de usu√°rios do R.
- Mantido pela Posit, PBC (anteriormente RStudio, PBC), e com uma grande comunidade ativa de desenvolvedores que contribuem para o seu aprimoramento.


## Quarto vs RMarkdown (1)

- Com o RMarkdown voc√™ pode fazer relat√≥rios, p√°ginas web e apresenta√ß√µes simples, assim como fazemos no Quarto.
- Mas para produzir dashboards, livros, artigos cient√≠ficos, sites (blogs), etc. uma s√©rie de pacotes extras precisam ser usados, √†s vezes combina√ß√µes de v√°rios deles. **Quarto j√° tem isso incluso**.

## Quarto vs RMarkdown (2)

- RMarkdown mistura [Markdown](https://en.wikipedia.org/wiki/Markdown) com se√ß√µes escritas em R, e n√£o √© f√°cil incorporar c√≥digo em outras linguagens de programa√ß√£o (por exemplo, Python, Julia). **No Quarto, h√° suporte para utiliza√ß√£o de m√∫ltiplas linguagens de programa√ß√£o no mesmo documento**.
- Incluir componentes como diagramas, refer√™ncias a tabelas ou figuras, entre outros, requer configura√ß√µes especiais e pacotes secund√°rios no RMarkdown, **n√£o no Quarto, que j√° possui suporte para todas essas funcionalidades**.

::: notes
**Dizer**:

Embora o RMarkdown permita muito do que podemos fazer com o Quarto, n√£o precisamos instalar uma s√©rie de pacotes extras (com suas depend√™ncias) como ter√≠amos que fazer para fazer coisas mais complicadas no RMarkdown.
:::

## Do RMarkdown para o Quarto

![Quarto simplifica a gera√ß√£o de diversos documentos, sites, artigos cient√≠ficos, apresenta√ß√µes, dashboards, etc.](images/rmarkdown-quarto.drawio.png)

## Novos caracter√≠sticas no Quarto

:::: {.columns}

::: {.column width="50%"}
- Refer√™ncias cruzadas
- Design avan√ßado
- Pain√©is avan√ßados para distribui√ß√µes e figuras
- Diagramas
- Extens√µes
- Gerenciamento de bibliografia
:::

::: {.column width="50%"}
- Interatividade
- Metadados inteligentes (YAML)
- Publica√ß√£o em v√°rios formatos
- Conte√∫do condicional
- Filtros em notebooks
:::

::::


## Objetivos do Quarto

- Melhorar drasticamente o processo de cria√ß√£o e colabora√ß√£o na produ√ß√£o de conte√∫dos reproduz√≠veis: relat√≥rios t√©cnicos, artigos cient√≠ficos, etc., com base na experi√™ncia de desenvolvimento e utiliza√ß√£o do RMarkdown.
- Permitir a utiliza√ß√£o do mesmo documento de origem, que pode ser convertido para v√°rios formatos: HTML, PDF, MS Word, ePub, OpenDocument, etc.
- Incluir outras linguagens de programa√ß√£o dentro do paradigma _**programa√ß√£o literal**_.

## Programa√ß√£o literal (1)

- O termo "Programa√ß√£o Alfabetizada" foi cunhado por [Donald Knuth](https://en.wikipedia.org/wiki/Donald_Knuth) em 1984.
- Envolve combinar a explica√ß√£o do funcionamento de um programa, de forma narrativa e utilizando uma linguagem natural, e n√£o apenas a sintaxe formal de uma linguagem de programa√ß√£o.
- Qualquer forma de comunica√ß√£o t√©cnica e cient√≠fica (artigo, p√¥ster, apresenta√ß√£o, relat√≥rio), envolve contar uma hist√≥ria para que a mensagem seja intelig√≠vel.

## Programa√ß√£o literal (2)

- A programa√ß√£o literal permite escrever, de forma integrada, o c√≥digo utilizado para o c√°lculo, de forma a contextualizar e significar os resultados, explicar pressupostos, considera√ß√µes e decis√µes da an√°lise.
- Tudo isto torna o documento criado n√£o s√≥ mais compreens√≠vel, mas eminentemente reproduz√≠vel e replic√°vel.

## O que podemos criar com Quarto?

::: {.panel-tabset}

### Livros

[![](images/screenshot-book.png){height=5in}](https://jjallaire.github.io/hopr/)

### Sites

[![](images/screenshot-website.png){height=5in}](https://quarto.org)

### Artigos

[![](images/screenshot-article.png){height=5in}](https://quarto-journals.github.io/biophysical-journal/)

### Dashboards

[![](images/screenshot-dashboard.png){height=5in}](https://colorado.posit.co/rsc/nz-quakes/quakes.html)

### Apresenta√ß√µes

[![](images/screenshot-exp-design.png)](https://emitanaka.org/slides/toronto2022)

:::

## Como funciona o Quarto?

```{mermaid}
%% { init: { 'flowchart': { 'curve': 'monotoneX'} } }
flowchart LR
    A["üìì Quarto (qmd)"] -->|" R "| B("üß∂ knitr")
    A -->|" Python "| C("üì¶ jupyter")
    B --> D["üìù Markdown (md)"]
    C --> D
    B --> E("üñºÔ∏è png, svg, etc.")
    C --> E
    D --> P(["‚öôÔ∏è pandoc"])
    E --> P
    P --> F{{"üîÆ"}}
    F --> G["üåê HTML"]
    F --> H["üìÑ PDF"]
    F --> I["üìÉ DOCX"]
    F --> L["üìò EPUB"]
    F --> M[... y muchos mas]
    classDef output fill:#f8d568;
    class G,H,I,L,M output;
    classDef interm fill:#7cfc00;
    class B,C,D,E interm;
    style P fill:#e6e6fa,stroke-width:3px;
    style A fill:yellow,color:black;
    style F fill:white,stroke-width:2px,stroke-dasharray:5 5;
```

## Quarto: Componentes

::::: {.panel-tabset}

### Metadados

:::: {.columns}

::: {.column width="50%"}
![](images/yaml.png){height=5in}
:::

::: {.column width="50%"}
- Use [YAML](https://yaml.org/) (Yet Ain't Markup Language), uma linguagem para descrever conte√∫do, f√°cil de editar, entender e ler.
- No Quarto, descreva os par√¢metros do documento e quais formatos de sa√≠da ser√£o gerados.
- Cont√©m tamb√©m informa√ß√µes sobre autoria, idioma do texto, etc.
:::

::::

### Blocos de c√≥digo

:::: {.columns}

::: {.column width="50%"}
![](images/code-chunks.png){height=5in}
:::

::: {.column width="50%"}
- Inclui c√≥digo em R (ou Python, Julia e ObservableJS) para processar dados e gerar resultado, tabela, gr√°fico, etc.
- √â delimitado por aspas invertidas, indicando o idioma utilizado:

```` markdown
```r
# ... c√≥digo em R
```
````

:::

::::


### Texto em Markdown

:::: {.columns}

::: {.column width="50%"}
![](images/markdown-text.png){height=5in}
:::

::: {.column width="50%"}

[Markdown](https://quarto.org/docs/authoring/markdown-basics.html):

- *It√°lico* (`*It√°lico*`)
- **Destacado** (`**Destacado**`)
- Cabe√ßalhos:
 - Primeiro n√≠vel (`#H1`)
 - Segundo n√≠vel (`## H2`), etc.
- Listas (`- Listas`)
- Equa√ß√µes: $E = mc^{2}$ (`Equa√ß√µes: $E = mc^{2}$`)

:::

::::

:::::


## Quarto na pr√°tica {.title-top-light background-image="images/horst_penguins_telescope.png" aria-label="Um pinguim nos ombros de outro, em uma paisagem nevada, visto atrav√©s de um telesc√≥pio no logotipo do Quarto como se fosse a lua no firmamento."}

::: attribution
Arte de [Allison Horst](https://allisonhorst.com/)
:::

## Um exemplo desenvolvido

- Usaremos os dados do pacote {[palmerpenguins](https://allisonhorst.github.io/palmerpenguins/)}, como base para criar um relat√≥rio HTML simples usando Quarto- O documento em Quarto conter√°:
 - Uma breve descri√ß√£o dos dados
 - C√≥digo para processar os dados
 - Algumas tabelas de resumo
 - Dois gr√°ficos: um gr√°fico de barras e um gr√°fico de dispers√£o

## Instalando o Quarto

Baixe e instale o execut√°vel em [https://quarto.org/docs/get-started/](https://quarto.org/docs/get-started/)
![](images/download-quarto.png)


## Instalando pacotes no RStudio

Vamos ter certeza de que temos `{tidyverse}` e `{palmerpenguins}` instalados
```{r eval=FALSE,echo=TRUE}
install.packages("tidyverse")
install.packages("palmerpenguins")
```

## Metadados do documento

```yaml
---
title: "Pinguins de Palmer"                # <1>
subtitle: "Um exemplo de uso do Quarto"    # <1>
license: CC BY-NC-SA                       # <2>
author:                                    # <3>
  - name: Jesus M. Castagnetto, Ph.D.      # <3>
    orcid: 0000-0002-7188-1605             # <3>  
    email: jesus@upch.pe                   # <3>
    affiliation: INSIGHT Project / UPCH    # <3>  
lang: pt                                   # <4>  
format:                                    # <5> 
  html:  # gera HTML
    code-fold: true # esconde o c√≥digo
    self-contained-math: true                
    embed-resources: true                 
    toc: true                             
    execute:  # inclui c√≥digo em HTML    
      warning: false                      
      echo: true 

---
```
1. T√≠tulo e subt√≠tulo
2. Licen√ßa
3. Autoria
4. Idioma (portuguese)
5. Formatos de sa√≠da


## Carregando bibliotecas e dados

```` markdown
```r
# carregamos as bibliotecas que precisamos
library(tidyverse)
library(knitr)
library(palmerpenguins)  # dados
```
````

## Adicionando uma introdu√ß√£o

``` markdown
## Introdu√ß√£o

Este √© um exemplo de relat√≥rio simples,
em formato HTML, gerado usando Quarto.

Vamos usar os dados dos pinguins do arquip√©lago
de Palmer (Ant√°rtica), que eram originalmente
coletado por **Dr. Kristen Gorman**, como
parte do *Programa de Pesquisa Ecol√≥gica
Plano de Longo Prazo da Esta√ß√£o Palmer* (LTER:
Pesquisa Ecol√≥gica de Longo Prazo).

```

## Misturando c√≥digo e texto

Podemos adicionar c√°lculos e resultados diretamente, junto com o texto, utilizando crases, e indicando a linguagem de programa√ß√£o, conforme mostrado abaixo:

![](images/inline-code-pt.png)

## Como √© a introdu√ß√£o

![](images/intro-output-pt.png){height=6in}

## Preparando os dados

```{r eval=FALSE,echo=TRUE}
esp_sexo <- penguins %>% 
  group_by(
    species,
    sex
  ) %>% 
  summarise(
    total = n(),
    n_islas = n_distinct(island),
    prom_long_pico = mean(bill_length_mm, na.rm = TRUE),
    sd_long_pico = sd(bill_length_mm, na.rm = TRUE),
    prom_prof_pico = mean(bill_depth_mm, na.rm = TRUE),
    sd_prof_pico = sd(bill_depth_mm, na.rm = TRUE),
    prom_long_ala = mean(flipper_length_mm, na.rm = TRUE),
    sd_long_ala = sd(flipper_length_mm, na.rm = TRUE),
    prom_peso = mean(body_mass_g, na.rm = TRUE),
    sd_peso = sd(body_mass_g, na.rm = TRUE)
  ) %>% 
  ungroup() %>% 
  mutate(  # Muda o conte√∫do para portuguese
    sex = case_when(
        sex == "male" ~ "Masculino",
        sex == "female" ~ "Femenino",
        is.na(sex) ~ "Desconhecido"
      )
  )
```

## Dados para tabelas

```{r eval=FALSE,echo=TRUE}
# Vamos usar mutate() para criar novos
# colunas no formato que desejamos
tab_pinguinos <- esp_sexo %>% 
  mutate(
    long_pico = paste(
      round(prom_long_pico, 1),
      " (",
      round(sd_long_pico, 1),
      ")"
    ),
    prof_pico = paste(
      round(prom_prof_pico, 1),
      " (",
      round(sd_prof_pico, 1),
      ")"
    ),
    long_ala = paste(
      round(prom_long_ala, 1),
      " (",
      round(sd_long_ala, 1),
      ")"
    ),
    peso = paste(
      round(prom_peso, 1),
      " (",
      round(sd_peso, 1),
      ")"
    )
  ) %>% 
  select( # seleccionar y renombrar las columnas
    Especie = species,
    Sexo = sex,
    Total = total,
    Islas = n_islas,
    "Pico (long)" = long_pico,
    "Pico (prof)" = prof_pico,
    Aleta = long_ala,
    Peso = peso
  )
```


## Produzindo as tabelas

:::: {.columns}

::: {.column width="50%"}
```{r eval=FALSE,echo=TRUE}
# tabela 1
kable(
  tab_pinguinos %>% 
    select(
      Especie, 
      Sexo, 
      Total, 
      Islas
    )
)
```
:::

::: {.column width="50%"}
```{r eval=FALSE,echo=TRUE}
# tabela 2
kable(
  tab_pinguinos %>% 
    select(
      -Total, 
      -Islas
    )
)
```
:::

::::


## As tabelas

![](images/output-tables-pt.png){height=6in}

## Um gr√°fico de barras

:::: {.columns}

::: {.column width="60%"}

```{r echo=TRUE,eval=FALSE}
ggplot(
  penguins, 
  aes(x = species, fill = island)
) +
  geom_bar() +
  labs(
    title = "Distribui√ß√£o dos pinguins por cada ilha",
    x = "Esp√©cie",
    y = "Frequ√™ncia",
    fill = "Ilhas"
  ) +
  theme_bw(16) +
  theme(
    legend.position = "top"
  )
```
:::

::: {.column width="40%"}
![](images/barchart-penguins-pt.png)
:::

::::

## O gr√°fico de dispers√£o (pontos)

:::: {.columns}

::: {.column width="60%"}


```{r echo=TRUE,eval=FALSE}
ggplot(
  penguins,
  aes(x = bill_length_mm, 
      y = flipper_length_mm, 
      color = species)
) +
  geom_point() +
  scale_color_brewer(palette = "Paired") +
  labs(
    title = "Rela√ß√£o entre a longitude do pico e a aleta",
    subtitle = "Pinguins do Palmer",
    x = "Longitude do pico (en mm)",
    y = "Longitude da aleta (en mm)",
    color = "Esp√©cie"
  ) +
  theme_classic(16)
```

:::

::: {.column width="40%"}
![](images/scatterplot-penguins-pt.png)
:::

::::

## O documento HTML final

<iframe src="los-pinguinos-de-palmer-pt.html" height="70%" width="90%"></iframe>

## Pr√≥ximas etapas

- Dia 3:
  - Apresenta√ß√£o do dashboard baseado no Quarto, criado para uso de cada pa√≠s.
  - Detalhes de como o painel funciona e est√° organizado.

- Dia 4:
  - Cria√ß√£o de scripts ad-hoc para convers√£o de dados brutos em dados que sigam o modelo de dados e com conte√∫do harmonizado.
  - Produ√ß√£o de dashboards com base nos dados transformados.


## Recursos

- [P√°gina principal do Quarto](https://quarto.org)
 - [Instala√ß√£o do Quarto](https://quarto.org/docs/get-started/)
- [Awesome Quarto (Micka√´l Canouil)](https://github.com/mcanouil/awesome-quarto)
- [Intro to Quarto (Isabella Vel√°squez)](https://ivelasq.quarto.pub/intro-to-quarto)
- [Hello Quarto (Mine Cetinkaya-Rundel)](https://mine.quarto.pub/hello-quarto/)
- [Getting started with Quarto (Tom Mock)](https://rstudio-conf-2022.github.io/get-started-quarto/)
