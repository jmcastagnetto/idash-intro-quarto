---
title: "Los pingüinos de Palmer"
subtitle: "Un ejemplo de uso de Quarto"
license: CC BY-NC-SA
author:
  - name: Jesus M. Castagnetto, Ph.D.
    orcid: 0000-0002-7188-1605
    email: jesus@upch.pe
    affiliation: INSIGHT / UPCH
lang: es

format: 
  html:
    code-fold: true   # mantener el código, pero inicialmente oculto
    self-contained-math: true
    embed-resources: true
    toc: true
    execute:  # sólo para HTML incluímos el código 
      warning: false
      echo: true
  docx: 
    execute:
      warning: false
      echo: false
  epub:
    execute:
      warning: false
      echo: false
---

```{r}
# cargar las librerías que necesitamos
library(tidyverse)
library(knitr)
library(palmerpenguins)
```

## Introducción

Este es un ejemplo de un reporte sencillo, en formato HTML, generado usando Quarto.

Vamos a usar los datos de pingüinos del archipiélago de Palmer (Antártica), que fueron originalmente recolectados por la **Dra. Kristen Gorman**, como parte del *Programa de Investigación Ecológica de Largo Plazo* de la Estación Palmer (LTER: Long Term Ecological Research).

Estos datos incluyen medidas anatómicas, pesos, y otros parámetros de pingüinos adultos de las especies Adélie, Chinstrap y Gentoo, en las áreas cercanas a la Estación Palmer.

El conjunto de datos está disponible como un paquete de R: [palmerpenguins](https://allisonhorst.github.io/palmerpenguins/), a través del esfuerzo de [Allison Horst](https://www.allisonhorst.com/), [Alison Hill](https://www.apreshill.com/) y [Kristen Gorman](https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php). En las siguientes secciones vamos a usar estos datos para ilustrar la creación de una tabla simple, y un par de gráficos.

A continuación podemos observar un resúmen de la estructura de los datos:

```{r}
glimpse(penguins)
```

Estos datos tienen `r ncol(penguins)` columnas, y `r nrow(penguins)` registros de pingüinos, que fueron encontrados en `r length(unique(penguins$island))` islas: `r paste(levels(penguins$island), collapse = ", ")`


## Estadísticas de los pinguinos por especie y sexo

Vamos a crear un par de tablas resumiendo los datos que tenemos de los pingüinos, para lo cual calcularemos, para cada combinación de especie y sexo, el total de individuos registrados, el número de islas en los que aparecen, así como los promedios y desviaciones estándar de: la longitud del pico y la aleta, de la profundidad del pico, y del peso de los pingüinos.

```{r}
esp_sexo <- penguins %>% 
  group_by(
    species,
    sex
  ) %>% 
  summarise(
    total = n(),
    n_islas = n_distinct(island),
    prom_long_pico = mean(bill_length_mm, na.rm = TRUE),
    sd_long_pico = sd(bill_length_mm, na.rm = TRUE),
    prom_prof_pico = mean(bill_depth_mm, na.rm = TRUE),
    sd_prof_pico = sd(bill_depth_mm, na.rm = TRUE),
    prom_long_ala = mean(flipper_length_mm, na.rm = TRUE),
    sd_long_ala = sd(flipper_length_mm, na.rm = TRUE),
    prom_peso = mean(body_mass_g, na.rm = TRUE),
    sd_peso = sd(body_mass_g, na.rm = TRUE)
  ) %>% 
  ungroup() %>% 
  mutate(  # Cambiar los contenidos al español
    sex = case_when(
        sex == "male" ~ "Masculino",
        sex == "female" ~ "Femenino",
        is.na(sex) ~ "Desconocido"
      )
  )
```

Los datos agregados, vamos a arreglarlos de tal manera que podamos crear un par de tablas:

1. La primera, mostrando para cada combinación de especie y sexo, el número de individuos y en cuantas islas se encuentran.
2. Una segunda en la que se tengan las medidas numéricas en la forma: *promedio (desv. estándar)*, y todas con un sólo decimal de precisión.

```{r}
# Usemos mutate() para crear nuevas columnas en el formato que queremos
tab_pinguinos <- esp_sexo %>% 
  mutate(
    long_pico = paste(
      round(prom_long_pico, 1),
      " (",
      round(sd_long_pico, 1),
      ")"
    ),
    prof_pico = paste(
      round(prom_prof_pico, 1),
      " (",
      round(sd_prof_pico, 1),
      ")"
    ),
    long_ala = paste(
      round(prom_long_ala, 1),
      " (",
      round(sd_long_ala, 1),
      ")"
    ),
    peso = paste(
      round(prom_peso, 1),
      " (",
      round(sd_peso, 1),
      ")"
    )
  ) %>% 
  select( # seleccionar y renombrar las columnas
    Especie = species,
    Sexo = sex,
    Total = total,
    Islas = n_islas,
    "Pico (long)" = long_pico,
    "Pico (prof)" = prof_pico,
    Aleta = long_ala,
    Peso = peso
  )
```

La tabla de distribución por especie y sexo

```{r}
# tabla 1
kable(
  tab_pinguinos %>% 
    select(Especie, Sexo, Total, Islas)
)
```

Y la tabla de distribución de las medidas numéricas

```{r}
# tabla 2
kable(
  tab_pinguinos %>% 
    select(-Total, -Islas)
)
```



## Ejemplos de gráficos

Con los datos originales, vamos ahora a crear un par de gráficos sencillos, uno de barras y otro de dispersión.

### Gráfico de barras

Primero, vamos a mostrar la distribución del número de pingüinos registrados por cada especie e isla. Coloreando los segmentos de las barras usan la isla en que fueron encontrados.

```{r}
ggplot(
  penguins, 
  aes(x = species, fill = island)
) +
  geom_bar() +
  labs(
    title = "Distribución de pingüinos por cada isla",
    x = "Especie",
    y = "Frecuencia",
    fill = "Islas"
  ) +
  theme_bw(16) +
  theme(
    legend.position = "top"
  )
```

### Gráfico de dispersión

Y para nuestro segundo (y último) gráfico, observemos cual es la correlación entre las longitudes (en mm) de los picos y aletas de los pingüinos, coloreando cada punto por la especie a la que pertenecen. 

Usaremos una escala de colores que sea amigable a quienes tienen daltonismo ("Paired")^[Otras escalas se pueden explorar en [https://colorbrewer2.org/](https://colorbrewer2.org/)]

```{r}
ggplot(
  penguins,
  aes(x = bill_length_mm, 
      y = flipper_length_mm, 
      color = species)
) +
  geom_point() +
  scale_color_brewer(palette = "Paired") +
  labs(
    title = "Relación entre la longitud del pico y la aleta",
    subtitle = "Pingüinos de Palmer",
    x = "Longitud del pico (en mm)",
    y = "Longitud de la aleta (en mm)",
    color = "Especie"
  ) +
  theme_classic(16)
```

El gráfico nos indica que, en general, los pingüinos Gentoo tienen las aletas y picos mas largos, los de la especie Adelie los mas cortos, y los de la especie Chinstrap se sitúan en valores intermedios.

